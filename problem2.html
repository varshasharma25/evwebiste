<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem 2 - Archimedean Spiral | Virtual Lab</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        #tutorialCanvas {
            background: #fff;
            border: 1px solid var(--primary-blue);
            border-radius: 8px;
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <h1>Problem 2: Archimedean Spiral</h1>
            <p>Interactive Step-by-Step Construction (A is Pole, AB=30mm, AC=40mm)</p>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <div class="drawing-display">
                <img src="images/archimedean_spiral_ref.png" alt="Archimedean Spiral Reference" class="drawing-img">
            </div>
            <div class="data-box">
                <p><strong>GIVEN DATA:</strong></p>
                <p>AB = 30 mm | AC = 40 mm | ∠BAC = 45°</p>
                <p>Lead of Spiral = 80 mm (One full convolution)</p>
            </div>
            <div style="text-align: center;">
                <button class="btn" onclick="startTutorial()">Watch Step-by-Step Formation</button>
            </div>
        </div>

        <div id="tutorialSection" class="card tutorial-section hidden">
            <h2 id="stepTitle">Step 1</h2>
            <div class="step-info" style="margin-bottom: 1.5rem;">
                <p id="stepDesc" class="step-desc">Loading...</p>
            </div>

            <div class="drawing-display">
                <canvas id="tutorialCanvas" width="800" height="550"></canvas>
            </div>

            <div class="step-controls">
                <button class="btn" id="prevBtn" onclick="prevStep()" style="background-color: #666;">Previous
                    Step</button>
                <button id="nextBtn" class="btn" onclick="nextStep()">Next Step</button>
            </div>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <a href="practical3.html" class="btn" style="background-color: #666;">← Back to Practical 3</a>
        </div>
    </main>

    <script>
        const canvas = document.getElementById('tutorialCanvas');
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const scale = 3.2;

        const darkBlue = '#1976d2';
        const grayLine = 'rgba(0, 0, 0, 0.2)';
        const greenCurve = '#388e3c';
        const redPoint = '#d32f2f';

        let currentStepIdx = 0;

        function clear() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#f0f4f8';
            ctx.setLineDash([]);
            for (let i = 0; i < canvas.width; i += 50) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke(); }
            for (let i = 0; i < canvas.height; i += 50) { ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke(); }
        }

        function getSpiralPoint(angleDeg) {
            const theta = (angleDeg * Math.PI) / 180;
            const r = (40 + (40 / Math.PI) * theta) * scale;
            return {
                x: centerX + r * Math.cos(theta),
                y: centerY + r * Math.sin(theta)
            };
        }

        const steps = [
            {
                title: "Step 1",
                desc: "mark a point a as pole. draw a horizontal reference ray AX extended.",
                draw: () => {
                    drawPoint(centerX, centerY, 'A (Pole)', redPoint);
                    drawLine(centerX, centerY, canvas.width - 50, centerY, darkBlue, false);
                    ctx.fillStyle = darkBlue;
                    ctx.fillText('X', canvas.width - 45, centerY + 5);
                }
            },
            {
                title: "Step 2",
                desc: "Mark point C on ray AX such that AC = 40 mm (Lead of spiral).",
                draw: () => {
                    const pC = getSpiralPoint(0);
                    drawPoint(pC.x, pC.y, 'C (40mm)', darkBlue);
                    drawLine(centerX, centerY, pC.x, pC.y, darkBlue, false);
                }
            },
            {
                title: "Step 3",
                desc: "Construct ∠BAC = 45°. Draw a ray and extend the line AB = 30 mm boldly.",
                draw: () => {
                    const pB = getSpiralPoint(-45);
                    drawPoint(pB.x, pB.y, 'B (30mm)', darkBlue);
                    ctx.lineWidth = 3;
                    drawLine(centerX, centerY, pB.x, pB.y, '#000', false);
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.strokeStyle = grayLine;
                    ctx.arc(centerX, centerY, 40, -Math.PI / 4, 0);
                    ctx.stroke();
                    ctx.fillText('45°', centerX + 45, centerY - 15);
                }
            },
            {
                title: "Step 4",
                desc: "now make a line of 20 mm from the pole A at 45 degree before the 30 mm line.",
                draw: () => {
                    const p20 = getSpiralPoint(-90);
                    drawPoint(p20.x, p20.y, '20mm', darkBlue, 3);
                    drawLine(centerX, centerY, p20.x, p20.y, grayLine, true);
                }
            },
            {
                title: "Step 4 (cont.)",
                desc: "now make a line of 50mm from the pole A at 45 degree after the 40 mm line.",
                draw: () => {
                    const p50 = getSpiralPoint(45);
                    drawPoint(p50.x, p50.y, '50mm', darkBlue, 3);
                    drawLine(centerX, centerY, p50.x, p50.y, grayLine, true);
                }
            },
            {
                title: "Step 5",
                desc: "now make a line of 60mm from the pole A at 45 degree after the 50 mm line.",
                draw: () => {
                    const p60 = getSpiralPoint(90);
                    drawPoint(p60.x, p60.y, '60mm', darkBlue, 3);
                    drawLine(centerX, centerY, p60.x, p60.y, grayLine, true);
                }
            },
            {
                title: "Step 6",
                desc: "now make a line of 70mm from the pole A at 45 degree after the 60 mm line.",
                draw: () => {
                    const p70 = getSpiralPoint(135);
                    drawPoint(p70.x, p70.y, '70mm', darkBlue, 3);
                    drawLine(centerX, centerY, p70.x, p70.y, grayLine, true);
                }
            },
            {
                title: "Step 7",
                desc: "now make a line of 80mm from the pole A at 45 degree after the 70 mm line.",
                draw: () => {
                    const p80 = getSpiralPoint(180);
                    drawPoint(p80.x, p80.y, '80mm', darkBlue, 3);
                    drawLine(centerX, centerY, p80.x, p80.y, grayLine, true);
                }
            },
            {
                title: "Step 8",
                desc: "now join all the pints and name the joining like as archimedean spiral.",
                draw: () => {
                    const ps = [];
                    for (let a = -180; a <= 180; a += 1) {
                        ps.push(getSpiralPoint(a));
                    }
                    gsap.to({}, {
                        duration: 3,
                        onUpdate: function () {
                            const p = this.progress();
                            clear();
                            for (let j = 0; j < steps.length - 1; j++) steps[j].draw();
                            ctx.beginPath(); ctx.strokeStyle = greenCurve; ctx.lineWidth = 4;
                            ctx.setLineDash([]);
                            ctx.moveTo(ps[0].x, ps[0].y);
                            for (let i = 1; i < ps.length * p; i++) { ctx.lineTo(ps[i].x, ps[i].y); }
                            ctx.stroke();
                        }
                    });
                }
            }
        ];

        function drawLine(x1, y1, x2, y2, color, dashed = false) {
            ctx.beginPath(); ctx.strokeStyle = color;
            if (dashed) ctx.setLineDash([5, 5]); else ctx.setLineDash([]);
            ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
        }
        function drawArc(x, y, r, start, end, color, dashed = false) {
            ctx.beginPath(); ctx.strokeStyle = color; if (dashed) ctx.setLineDash([5, 5]); else ctx.setLineDash([]);
            ctx.arc(x, y, r, start, end); ctx.stroke();
        }
        function drawPoint(x, y, label, color, size = 4) {
            ctx.beginPath(); ctx.fillStyle = color; ctx.arc(x, y, size, 0, Math.PI * 2); ctx.fill();
            if (label) { ctx.fillStyle = darkBlue; ctx.font = '600 12px Poppins'; ctx.fillText(label, x + 8, y - 8); }
        }

        function startTutorial() {
            document.getElementById('tutorialSection').classList.remove('hidden');
            setTimeout(() => { document.getElementById('tutorialSection').scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
            currentStepIdx = 0; updateUI();
        }

        function updateUI() {
            const step = steps[currentStepIdx];
            document.getElementById('stepTitle').innerText = step.title;
            document.getElementById('stepDesc').innerText = step.desc;
            clear();
            for (let i = 0; i <= currentStepIdx; i++) {
                if (i !== steps.length - 1 || currentStepIdx === steps.length - 1) steps[i].draw();
            }
            document.getElementById('prevBtn').disabled = (currentStepIdx === 0);
            document.getElementById('nextBtn').innerText = (currentStepIdx === steps.length - 1) ? "Finished" : "Next Step";
        }

        function nextStep() { if (currentStepIdx < steps.length - 1) { currentStepIdx++; updateUI(); } }
        function prevStep() { if (currentStepIdx > 0) { currentStepIdx--; updateUI(); } }
        clear();
    </script>
</body>

</html>