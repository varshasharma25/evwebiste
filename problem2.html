<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem 2 - Hypocycloid | Virtual Lab</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        #tutorialCanvas {
            background: #fff;
            border: 1px solid var(--primary-blue);
            border-radius: 8px;
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <h1>Problem 2: Hypocycloid</h1>
            <p>Interactive Step-by-Step Construction</p>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <div class="drawing-display">
                <img src="images/hypocycloid_final.png" alt="Hypocycloid Final" class="drawing-img">
            </div>
            <div class="data-box">
                <p><strong>GIVEN DATA:</strong></p>
                <p>Directing Circle (D) = 200 mm | Rolling Circle (d) = 50 mm</p>
                <p>O = Center of Directing Circle. θ = (50/200)*360 = 90°</p>
            </div>
            <div style="text-align: center;">
                <button class="btn" onclick="startTutorial()">Watch Step-by-Step Formation</button>
            </div>
        </div>

        <div id="tutorialSection" class="card tutorial-section hidden">
            <h2 id="stepTitle">Step 1</h2>
            <div class="step-info" style="margin-bottom: 1.5rem;">
                <p id="stepDesc" class="step-desc">Loading...</p>
            </div>

            <div class="drawing-display">
                <canvas id="tutorialCanvas" width="800" height="550"></canvas>
            </div>

            <div class="step-controls">
                <button class="btn" id="prevBtn" onclick="prevStep()" style="background-color: #666;">Previous
                    Step</button>
                <button id="nextBtn" class="btn" onclick="nextStep()">Next Step</button>
            </div>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <a href="practical3.html" class="btn" style="background-color: #666;">← Back to Practical 3</a>
        </div>
    </main>

    <script>
        const canvas = document.getElementById('tutorialCanvas');
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height - 80;
        const scale = 3.5;

        const darkBlue = '#1976d2';
        const grayLine = 'rgba(0, 0, 0, 0.1)';
        const greenCurve = '#388e3c';
        const redPoint = '#d32f2f';

        let currentStepIdx = 0;

        function clear() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#f8fbff';
            ctx.setLineDash([]);
            for (let i = 0; i < canvas.width; i += 50) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke(); }
            for (let i = 0; i < canvas.height; i += 50) { ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke(); }
        }

        const steps = [
            {
                title: "Step 1: Directing Arc",
                desc: "With center O and radius R = 100 mm, draw the directing arc. Mark the angle θ = 90°.",
                draw: () => {
                    drawArc(centerX, centerY, 100 * scale, -3 * Math.PI / 4, -Math.PI / 4, darkBlue);
                    drawLine(centerX, centerY, centerX + 110 * scale * Math.cos(3 * Math.PI / 4), centerY - 110 * scale * Math.sin(3 * Math.PI / 4), grayLine);
                    drawLine(centerX, centerY, centerX + 110 * scale * Math.cos(Math.PI / 4), centerY - 110 * scale * Math.sin(Math.PI / 4), grayLine);
                    drawPoint(centerX, centerY, 'O', darkBlue);
                }
            },
            {
                title: "Step 2: Drawing Rolling Circle",
                desc: "Draw the rolling circle (r = 25 mm) internally tangent to the directing circle at the start position.",
                draw: () => {
                    const ang = 3 * Math.PI / 4;
                    const cx = centerX + 75 * scale * Math.cos(ang);
                    const cy = centerY - 75 * scale * Math.sin(ang);
                    drawCircle(cx, cy, 25 * scale, darkBlue);
                    drawPoint(cx, cy, 'C', darkBlue);
                    drawPoint(centerX + 100 * scale * Math.cos(ang), centerY - 100 * scale * Math.sin(ang), 'P', redPoint);
                }
            },
            {
                title: "Step 3: Dividing Rolling Circle",
                desc: "Divide the rolling circle into 8 equal parts. This is essential for locating trace points.",
                draw: () => {
                    const ang = 3 * Math.PI / 4;
                    const cx = centerX + 75 * scale * Math.cos(ang);
                    const cy = centerY - 75 * scale * Math.sin(ang);
                    for (let i = 0; i < 8; i++) {
                        const dAng = i * Math.PI / 4 + ang;
                        const px = cx + 25 * scale * Math.cos(dAng);
                        const py = cy - 25 * scale * Math.sin(dAng);
                        drawPoint(px, py, '', darkBlue, 2);
                        drawLine(cx, cy, px, py, grayLine);
                    }
                }
            },
            {
                title: "Step 4: Radial Partitions",
                desc: "Divide the directing arc into 8 equal parts and draw radial lines from center O.",
                draw: () => {
                    for (let i = 0; i <= 8; i++) {
                        const theta = 3 * Math.PI / 4 - i * (Math.PI / 2) / 8;
                        drawLine(centerX, centerY, centerX + 115 * scale * Math.cos(theta), centerY - 115 * scale * Math.sin(theta), grayLine);
                    }
                }
            },
            {
                title: "Step 5: Path of Center C",
                desc: "Draw an arc from O through the center of the rolling circle. Mark positions C1, C2... C8.",
                draw: () => {
                    drawArc(centerX, centerY, 75 * scale, -3 * Math.PI / 4, -Math.PI / 4, 'rgba(25, 118, 210, 0.2)', true);
                    for (let i = 1; i <= 8; i++) {
                        const theta = 3 * Math.PI / 4 - i * (Math.PI / 2) / 8;
                        drawPoint(centerX + 75 * scale * Math.cos(theta), centerY - 75 * scale * Math.sin(theta), 'C' + i, darkBlue, 2);
                    }
                }
            },
            {
                title: "Step 6: Locating Points P1 to P8",
                desc: "Mark points P1 to P8 at the intersection of rolling circle radius and the respective division arcs.",
                draw: () => {
                    for (let i = 1; i <= 8; i++) {
                        const t = i * (Math.PI / 2) / 8;
                        const theta = 3 * Math.PI / 4 - t;
                        const psi = 3 * Math.PI / 4 + 3 * t;
                        const px = centerX + 75 * scale * Math.cos(theta) + 25 * scale * Math.cos(psi);
                        const py = centerY - (75 * scale * Math.sin(theta) + 25 * scale * Math.sin(psi));
                        drawPoint(px, py, 'P' + i, redPoint, 3);
                    }
                    for (let i = 1; i <= 4; i++) {
                        const r_proj = (100 - i * (50 / 4)) * scale;
                        drawArc(centerX, centerY, r_proj, -3 * Math.PI / 4, -Math.PI / 4, 'rgba(0,0,0,0.05)', true);
                    }
                }
            },
            {
                title: "Step 7: Perfect Hypocycloid Line",
                desc: "Join points P1 to P8 with a smooth green curve to complete the hypocycloid. ✨",
                draw: () => {
                    const ps = [];
                    for (let i = 0; i <= 100; i++) {
                        const t = (i / 100) * (Math.PI / 2);
                        const theta = 3 * Math.PI / 4 - t;
                        const psi = 3 * Math.PI / 4 + 3 * t;
                        const x = 75 * scale * Math.cos(theta) + 25 * scale * Math.cos(psi);
                        const y = 75 * scale * Math.sin(theta) + 25 * scale * Math.sin(psi);
                        ps.push({ x: centerX + x, y: centerY - y });
                    }
                    gsap.to({}, {
                        duration: 3,
                        onUpdate: function () {
                            const p = this.progress();
                            clear();
                            for (let j = 0; j < currentStepIdx; j++) if (j !== 6) steps[j].draw();
                            ctx.beginPath(); ctx.strokeStyle = greenCurve; ctx.lineWidth = 4;
                            ctx.setLineDash([]);
                            ctx.moveTo(ps[0].x, ps[0].y);
                            for (let i = 1; i < ps.length * p; i++) { ctx.lineTo(ps[i].x, ps[i].y); }
                            ctx.stroke();
                        }
                    });
                }
            }
        ];

        function drawLine(x1, y1, x2, y2, color, dashed = false) {
            ctx.beginPath(); ctx.strokeStyle = color; ctx.lineWidth = 1;
            if (dashed) ctx.setLineDash([5, 5]); else ctx.setLineDash([]);
            ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
        }
        function drawArc(x, y, r, start, end, color, dashed = false) {
            ctx.beginPath(); ctx.strokeStyle = color; if (dashed) ctx.setLineDash([5, 5]); else ctx.setLineDash([]);
            ctx.arc(x, y, r, start, end); ctx.stroke();
        }
        function drawCircle(x, y, r, color) {
            ctx.beginPath(); ctx.strokeStyle = color; ctx.setLineDash([]);
            ctx.arc(x, y, r, 0, Math.PI * 2); ctx.stroke();
        }
        function drawPoint(x, y, label, color, size = 4) {
            ctx.beginPath(); ctx.fillStyle = color; ctx.arc(x, y, size, 0, Math.PI * 2); ctx.fill();
            if (label) { ctx.fillStyle = darkBlue; ctx.font = '600 11px Poppins'; ctx.fillText(label, x + 6, y - 6); }
        }

        function startTutorial() {
            document.getElementById('tutorialSection').classList.remove('hidden');
            setTimeout(() => { document.getElementById('tutorialSection').scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
            currentStepIdx = 0; updateUI();
        }

        function updateUI() {
            const step = steps[currentStepIdx];
            document.getElementById('stepTitle').innerText = step.title;
            document.getElementById('stepDesc').innerText = step.desc;
            clear();
            for (let i = 0; i <= currentStepIdx; i++) { if (i !== 6 || currentStepIdx > 6) steps[i].draw(); }
            if (currentStepIdx === 6) steps[6].draw();
            document.getElementById('prevBtn').disabled = (currentStepIdx === 0);
            document.getElementById('nextBtn').innerText = (currentStepIdx === steps.length - 1) ? "Finished" : "Next Step";
        }

        function nextStep() { if (currentStepIdx < steps.length - 1) { currentStepIdx++; updateUI(); } }
        function prevStep() { if (currentStepIdx > 0) { currentStepIdx--; updateUI(); } }
        clear();
    </script>
</body>

</html>